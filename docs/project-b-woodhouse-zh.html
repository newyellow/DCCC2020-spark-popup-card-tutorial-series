<html>
  <head>
    <meta charset="UTF-8">
    <title>It's Now Winter -- Spark Pop-up Card Tutorial Series</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="style.css" />

    <!-- Bootstrap -->
    <script src="src/jquery-3.5.1.min.js"></script>
    <link rel="stylesheet" href="src/bootstrap.min.css">
    <script src="src/bootstrap.bundle.min.js"></script>


  </head>

  <body style="position: relative;" data-spy="scroll" data-target="#tutorial-project-b" data-offset="0">
    <div id="mobile-spacer">
    </div>

    <div id="mobile-nav">
        <nav class="navbar navbar-light bg-light" data-toggle="collapse" data-target="#mobile-nav-toggle" aria-expanded="false" aria-controls="mobile-nav-toggle">
            <a><span class="hamburger">☰</span> It's Now Winter @ 2020 DCCC</a>
            <div class="navbar lan-switch-mobile">
              <a href="project-b-woodhouse.html">ENG</a>
              <a href="project-b-woodhouse-zh.html">中文</a>
            </div>
        </nav>
        <nav id="mobile-nav-toggle" class="navbar navbar-light bg-light collapse">
            <a class="nav-link font-weight-bold" style="width: 100%" href="index-zh.html">計畫簡介</a>
            <a class="nav-link font-weight-bold" style="width: 100%" href="paper-prepare-zh.html">卡片製作相關</a>
            <a class="nav-link font-weight-bold" style="width: 100%" href="project-a-snowman-zh.html">Project A - 雪人</a>
            <a class="nav-link font-weight-bold" style="width: 100%" href="#">Project B - 木屋</a>
            <a class="nav-link font-weight-bold" style="width: 100%" href="project-c-xmastree-zh.html">Project C - Xmas Tree</a>
        </nav>
    </div>

    <div id="main-menu" class="overflow-auto">
        <div class="navbar lan-switch">
          <a href="project-b-woodhouse.html">ENG</a>
          <a href="project-b-woodhouse-zh.html">中文</a>
        </div>
        <nav class="navbar navbar-light bg-light">
          <a class="navbar-brand" href="index-zh.html">計畫簡介</a>
          <a class="navbar-brand" href="paper-prepare-zh.html">卡片製作相關</a>
          <a class="navbar-brand collapsed" style="cursor:pointer" data-toggle="collapse" data-target="#tutorial-project-a" aria-expanded="false" aria-controls="tutorial-project-a">Project A - 雪人</a>
          <nav id="tutorial-project-a" class="navbar navbar-light bg-light nav-pills collapse">
              <a class="nav-link font-weight-bold" href="project-a-snowman-zh.html">專案說明</a>
              <a class="nav-link font-weight-bold" href="project-a-snowman-zh.html#preparing-the-project">Spark 專案設定</a>
              <nav class="nav nav-pills flex-column">
                  <a class="nav-link ml-3" href="project-a-snowman-zh.html#create-new-project">建立新專案</a>
                  <a class="nav-link ml-3" href="project-a-snowman-zh.html#import-assets-from-computer">匯入檔案素材</a>
              </nav>
              <a class="nav-link font-weight-bold" href="project-a-snowman-zh.html#set-up-image-tracking">設定圖片辨識</a>
              <nav class="nav nav-pills flex-column">
                  <a class="nav-link ml-3" href="project-a-snowman-zh.html#set-up-tracking-target-image">選擇辨識圖檔</a>
                  <a class="nav-link ml-3" href="project-a-snowman-zh.html#test-the-tracker-image">測試辨識效果</a>
                  <a class="nav-link ml-3 text-info" href="project-a-snowman-zh.html#test-the-effect-with-the-spark-ar-player">*Spark 專用的測試 App</a>
                  <a class="nav-link ml-3 text-info" href="project-a-snowman-zh.html#best-practice-tracker-image">*製作好的辨識圖</a>
              </nav>
              <a class="nav-link font-weight-bold" href="project-a-snowman-zh.html#set-up-augmented-content">設定 AR 內容</a>
              <nav class="nav nav-pills flex-column">
                  <a class="nav-link ml-3" href="project-a-snowman-zh.html#materials-in-3d">3D 的材質</a>
                  <a class="nav-link ml-3" href="project-a-snowman-zh.html#adding-the-girl-into-the-scene">把女孩放入場景</a>
                  <a class="nav-link ml-3" href="project-a-snowman-zh.html#adjust-plane-scale-to-fit-image-ratio">調整圖片比例</a>
                  <a class="nav-link ml-3" href="project-a-snowman-zh.html#position-the-girl">設定女孩的位置</a>
                  <a class="nav-link ml-3 text-info" href="project-a-snowman-zh.html#move-scale-rotate-objects">*移動、縮放、旋轉物件</a>
                  <a class="nav-link ml-3" href="project-a-snowman-zh.html#adding-texts">加入文字</a>
              </nav>
              <a class="nav-link font-weight-bold" href="project-a-snowman-zh.html#animating-with-patch-editor">使用 Patch Editor 製作動畫</a>
              <nav class="nav nav-pills flex-column">
                  <a class="nav-link ml-3" href="project-a-snowman-zh.html#test-with-loop-animation">用 Loop Animation 測試動畫</a>
                  <a class="nav-link ml-3 text-info" href="project-a-snowman-zh.html#animation-curves">*動畫曲線 Animation Curves</a>
                  <a class="nav-link ml-3" href="project-a-snowman-zh.html#set-up-on-track-action">設定動畫觸發時機</a>
                  <a class="nav-link ml-3" href="project-a-snowman-zh.html#queueing-animations">讓動畫依序播放</a>
              </nav>
              <a class="nav-link font-weight-bold" href="project-a-snowman-zh.html#create-the-snow-effect">製作下雪特效</a>
              <nav class="nav nav-pills flex-column">
                  <a class="nav-link ml-3 text-info" href="project-a-snowman-zh.html#design-your-own-particle-effect">*關於粒子特效的製作</a>
              </nav>
          </nav>
          <a class="navbar-brand" data-toggle="collapse" style="cursor:pointer" data-target="#tutorial-project-b" aria-expanded="false" aria-controls="tutorial-project-b">Project B - 木屋</a>
          <nav id="tutorial-project-b" class="navbar navbar-light bg-light nav-pills collapse show">
              <a class="nav-link font-weight-bold" href="#project-description">專案說明</a>
              <a class="nav-link font-weight-bold" href="#set-up-tracking">設定圖片辨識</a>
              <a class="nav-link font-weight-bold" href="#setting-up-room-space">製作木屋房間</a>
              <nav class="nav nav-pills flex-column">
                  <a class="nav-link ml-3" href="#place-a-reference-image">使用參考圖</a>
                  <a class="nav-link ml-3" href="#set-up-the-walls">製作牆壁</a>
                  <a class="nav-link ml-3" href="#install-furniture">放入家具</a>
              </nav>
              <a class="nav-link font-weight-bold" href="#the-transparent-issue">半透明的問題</a>
              <nav class="nav nav-pills flex-column">
                  <a class="nav-link ml-3" href="#fixing-by-alpha-test">使用 Alpha Test</a>
                  <a class="nav-link ml-3" href="#fixing-by-setting-the-layers">使用圖層設定</a>
                  <a class="nav-link ml-3 text-info" href="#opacity-and-blend-mode">*透明度與混合模式</a>
              </nav>
              <a class="nav-link font-weight-bold" href="#animated-fire">動畫火焰</a>
              <a class="nav-link font-weight-bold" href="#setting-up-the-lights">設定光源</a>
              <nav class="nav nav-pills flex-column">
                  <a class="nav-link ml-3" href="#adding-lights-into-the-scene">在場景內加入燈光</a>
                  <a class="nav-link ml-3" href="#animating-the-light-intensity">設定光源動畫</a>
                  <a class="nav-link ml-3 text-info" href="#light-types">*光源的類型</a>
              </nav>
              <a class="nav-link font-weight-bold" href="#test-the-room">測試房間效果</a>
              <a class="nav-link font-weight-bold" href="#setting-up-the-mask">設定遮罩</a>
              <nav class="nav nav-pills flex-column">
                  <a class="nav-link ml-3" href="#set-up-walls-mask">製作牆壁遮罩</a>
                  <a class="nav-link ml-3" href="#set-up-window-mask">設定窗戶遮罩</a>
              </nav>
          </a>
          </nav>
          <a class="navbar-brand" data-toggle="collapse" style="cursor:pointer" data-target="#tutorial-project-c" aria-expanded="false" aria-controls="tutorial-project-c">Project C - 小樹</a>
          <nav id="tutorial-project-c" class="navbar navbar-light bg-light nav-pills collapse">
              <a class="nav-link font-weight-bold" href="project-c-xmastree-zh.html">專案說明</a>
              <a class="nav-link font-weight-bold" href="project-c-xmastree-zh.html#set-up-tracking">設定圖片辨識</a>
              <a class="nav-link font-weight-bold" href="project-c-xmastree-zh.html#set-up-the-object">設定場景物件</a>
              <nav class="nav nav-pills flex-column">
                  <a class="nav-link ml-3" href="project-c-xmastree-zh.html#create-a-two-sided-plane">建立雙面的 Plane</a>
                  <a class="nav-link ml-3 text-info" href="project-c-xmastree-zh.html#materials-double-sided-setting">*材質的 Double-Sided（雙面）選項</a>
                  <a class="nav-link ml-3" href="project-c-xmastree-zh.html#composing-the-chair">組裝長椅</a>
                  <a class="nav-link ml-3" href="project-c-xmastree-zh.html#placing-the-star">在樹上放置星星</a>
                  <a class="nav-link ml-3" href="project-c-xmastree-zh.html#make-it-snow">下雪</a>
                  <a class="nav-link ml-3" href="project-c-xmastree-zh.html#make-the-star-glow">讓星星發光</a>
              </nav>
              <a class="nav-link font-weight-bold" href="project-c-xmastree-zh.html#creating-the-illusion">營造空間感</a>
              <nav class="nav nav-pills flex-column">
                  <a class="nav-link ml-3" href="project-c-xmastree-zh.html#create-masks-for-the-tree">製作樹木遮罩</a>
                  <a class="nav-link ml-3 text-info" href="project-c-xmastree-zh.html#about-the-trail-and-error">*關於「測試、調整」位置的方法</a>
              </nav>
              <a class="nav-link font-weight-bold" href="project-c-xmastree-zh.html#additional-details">一些額外的細節製作</a>
          </nav>
      </nav>
    </div>

    <div id="main-nav-spacer">
    </div>


    <div id="main-section">

      <div id="image-wrapper">
          <div id="header-image" style="background-image: url(imgs/project-b/cover-b.jpg)">
          </div>
      </div>

      <article id="main">
        <h2 id="project-description">
          專案說明
        </h2>
        <p>
          在這個專案裡，我們會打造一個 3D 的房間，然後在掃描到卡片的窗戶時，會產生一種「從窗戶外看進去」的 AR 效果。
        </p>
        <div class="video-area">
          <iframe width="640" height="480" src="https://www.youtube.com/embed/D3c6aZadGQI" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
        </div>
        <p>透過這個專案，你將會學到 Spark AR 內的圖層設定、更深入了解材質的選項，並且學會如何製作遮罩效果（Masking）。</p>

        <h2>素材下載</h2>

        <p>本篇專案會用到的素材、卡片模板、以及已經完成的範例專案下載：<a target="_blank" href="download/ProjectB-Woodhouse.zip">Project B - Woodhouse.zip</a></p>

        <ul class="warning">
          <li>如果你對 Spark AR 並不熟，而且還沒看過雪人卡片教學的話，強烈建議先看雪人卡片的教學。雪人卡片教學裡面有一些基礎的操作，在本篇教學中並不會提到。</li>
        </ul>


        <h2 id="set-up-tracking">設定圖片辨識</h2>

        <p>在這個部分，你需要做幾件事：</p>
        <ol>
          <li>建立新專案</li>
          <li>在場景中加入 fixTargetTracker（或在開專案時選擇 Target Tracking）</li>
          <li>匯入專案要使用的圖片素材</li>
          <li>把 window 的圖片設定成辨識圖</li>
        </ol>

        <p>
          如果以上步驟都完成了，你應該會看到這個畫面：
        </p>

        <img src="imgs/project-b/01--setup-the-tracking-01.jpg" />

        <p>以上這些步驟在雪人教學裡面有詳細的步驟教學，如果你對這些東西不熟的話，可以先去看看雪人教學</p>


        <h2 id="setting-up-room-space">製作木屋房間</h2>

        <p>在這個專案裡，我們要呈現「從窗外看進去」的效果，因此，我們需要先建立一個窗內的空間</p>


        <h3 id="place-a-reference-image">使用參考圖</h3>
        <p>為了讓 AR 出來的空間符合實際卡片的大小，我們可以放一張參考圖來協助我們設定房間的空間大小</p>
        <ol>
          <li>在辨識圖物件底下加入一個 Plane，並且將 whole-building 這張圖設為 Plane 的材質</li>
          <img src="imgs/project-b/02--place-reference-image-01.jpg" />
          <li>調整一下 whole-building 這個 Plane 的物件大小，讓窗戶的部分符合中間辨識圖的部分</li>
          <img src="imgs/project-b/02--place-reference-image-02.gif" />
          <li>把材質的透明度（opacity）設定為 0.6，這樣就可以在編輯器裡看到整棟建築的樣子，這樣待會設定牆壁的時候，就有一個參考的依據</li>
          <img src="imgs/project-b/02--place-reference-image-03.jpg" />
        </ol>


        <h3 id="set-up-the-walls">製作牆壁</h3>
        <ol>
          <li>創造一個給牆壁使用的材質 “wall-mat”，並以 “wood-wall-texture” 當作材質貼圖</li>
          <img src="imgs/project-b/03--setup-the-walls-01.jpg" />
          <li>在場景內加入 ５ 個 Plane 並把他們拼成一個立方體的樣子，然後放到參考圖後面</li>
          <img src="imgs/project-b/03--setup-the-walls-02.gif" />
          <li>藉由這張參考圖來設定牆壁，可以讓牆壁的位置和大小更符合實際卡片的樣子，這會讓 AR 的效果看起來比較有真實感</li>
          <img src="imgs/project-b/03--setup-the-walls-03.jpg" />
        </ol>


        <h2 id="install-furniture">放入家具</h2>

        <ol>
          <li>在素材壓縮檔裡面有一些圖可以當作家具，隨意選些喜歡的，然後幫每一張圖建立一個材質，然後放到房間裡面</li>
          <img src="imgs/project-b/04--put-furnitures-01.jpg" />
          <li>這有點像是在製作一層一層的剪紙。家具的深度差異（位置 Z 的差異）可以創造一種視差的效果，在用 AR 觀看的時候可以營造出空間感</li>
          <img src="imgs/project-b/04--put-furnitures-02.gif" />
          <li>在放置家具的時候，可能會發現一些奇怪的狀況，像是某些圖明明應該是透明的部分，卻把背景遮掉了</li>
          <img src="imgs/project-b/04--put-furnitures-03.jpg" />
          <li>要解決這個問題，我們需要多了解一點關於 Spark AR 的圖層（Layer）和材質材質的設定</li>
        </ol>


        <h2 id="the-transparent-issue">半透明的問題</h2>

        <p>一張圖「透明」的部分會遮住背後的東西，這是由於 Spark AR 處理「透明」與「半透明」的方式所導致的結果。但這並不是因為 Spark AR 的系統沒有寫好，這是即時渲染的 3D 引擎中常見的狀況。<br />
        <br />
        在 Spark AR 裡面要解決這個問題，有兩種方式，各有其優缺點</p>


        <h3 id="fixing-by-alpha-test">使用 Alpha Test</h3>
        <p>在 Spark AR 裡面，即使圖片的某一部分是完全透明的（透明度 Alpha 為 0），這並不表示這個地方是「空」或是「無」的概念，3D 物件的形狀還是會存在，只是他的顏色是「透明色」。就像底下這張圖，你可以看到我們選取物件時，他的邊框仍然是方形的</p>
        <img src="imgs/project-b/05--fixing-alpha-test-01.jpg" />

        <p>在材質裡面有一個 “Alpha Test” 的選項，如果開啟這個選項，表示我們要把「透明」的部分剔除，讓他變成「無」的狀態。就像底下這張圖，當你選取物件的時候，邊框變成了沙發外框的形狀。Alpha Test 的數值代表的是剔除的「閥值」，透明度在這個數值以下的部分會被剔除掉，例如設為 10 表示透明度在 10% 以下的部分會被剔除掉。有些 3D 軟體裡面會稱這種材質為 “cutout” 材質，如其名就像被剪掉一樣的概念。</p>

        <img src="imgs/project-b/05--fixing-alpha-test-02.jpg" />

        <img src="imgs/project-b/05--fixing-alpha-test-03.jpg" />

        <p>以這個專案提供的素材來說，只要開啟 Alpha Test，就可以修正大部分的半透明問題</p>

        <img src="imgs/project-b/05--fixing-alpha-test-04.jpg" />

        <p>在家具的部分，由於圖片大部分都有很稅利的邊緣，而且沒有半透明的部分，因此 Alpha Test 應該符合大部分的使用狀況。但對於有「半透明」的圖，例如沙發的陰影、窗戶的反光等，就沒有辦法使用 Alpha Test。</p>

        <img src="imgs/project-b/05--fixing-alpha-test-05-01.jpg" />
        <img src="imgs/project-b/05--fixing-alpha-test-05-02.jpg" />

        <p>因此，我們也需要了解一下另一種解法</p>


        <h3 id="fixing-by-setting-the-layers">使用圖層設定</h3>

        <p>圖層（Layer）決定每個物件的渲染（Render）順序。如果物件距離攝影機比較近，該物件的圖層就應該要在比較上面。底下我們會替沙發的陰影和窗戶的反光來設定圖層選項。</p>

        <ol>
          <li>點選圖層 “Layers” 以切換顯示圖層設定的選項，位置就在場景 “Scene” 旁邊</li>
          <img src="imgs/project-b/06--layers-01.jpg" />
          <li>按下 “+ Add Layer” 新增圖層，我們一共會需要 4 個圖層。在名稱上點兩下滑鼠左鍵可以設定圖層的名稱</li>
          <img src="imgs/project-b/06--layers-02.jpg" />
          <li>用滑鼠左鍵拖拉圖層的名字可以改變排序，讓他們依照以下的順序排列：window-light、furniture、shadow、walls</li>
          <img src="imgs/project-b/06--layers-03.jpg" />
          <li>選擇 “wall plane” 物件，然後在右上方有一個 Layer 的地方可以設定圖層。把圖層設定為 walls</li>
          <img src="imgs/project-b/06--layers-04.jpg" />
          <li>可以一次選多個物件來批次設定圖層</li>
          <img src="imgs/project-b/06--layers-05.jpg" />
          <li>把所有的牆壁物件的圖層都設為 walls，所有家具圖層設為 furniture，沙發的陰影設定為 shadow，窗戶的反光設定為 window-light</li>
          <li>現在窗戶的反光和陰影應該都能正確呈現他們半透明的樣子</li>
          <img src="imgs/project-b/06--layers-07.jpg" />
        </ol>


        <h3 id="opacity-and-blend-mode">*透明度與混合模式</h3>

        <p>在材質裡面還有一個混合模式（Blending Mode）可以設定，這個選項定義了這張圖如何和「背後」的影像作用。例如 Multiply 會疊加深色的部分，沙發的陰影就可以設定為 Multiply；而 Additive 則是讓亮的部分更亮，因此窗戶的反光可以設定為 Additive。你可以隨意試試看切換不同的 Blending Mode 來看看效果如何。.</p>

        <img src="imgs/project-b/07--blend-mode-opacity-01.jpg" />

        <p>如果你覺得陰影太暗或是反光太亮，你也可以再調整它的透明度（Opacity）</p>

        <img src="imgs/project-b/07--opacity-combine.jpg" />

        <p>混合模式是電腦圖學領域常見的一個功能，如果想了解更多，可以參考 Adobe 關於 Blending Mode 的說明：<a target="_blank" href="https://helpx.adobe.com/photoshop/using/blending-modes.html">Adobe - Blending Modes</a></p>

        <p>如果你覺得 Spark AR 內建的 Blending Mode 不夠多，你想要更多類似 Photoshop 裡面有的其他 Blending Mode，你可以試試看 Spark AR 圖學高手 positlab 的開源專案 Photoshop blend modes：<a target="_blank" href="https://github.com/positlabs/spark-blend-modes">https://github.com/positlabs/spark-blend-modes</a></p>




        <h2 id="animated-fire">動畫火焰</h2>

        <p>在 Spark AR 裡面你也可以製作逐格動畫。在這個專案裡，我們準備了火焰的序列圖以供練習</p>

        <ol>
          <li>在 Assets 視窗點選 “Add Asset”</li>
          <img src="imgs/project-b/08--animated-fire-01.jpg" />
          <li>選擇 “Animation Sequence” 然後系統就會產生一個新的檔案，把它命名為 “fire-animation”</li>
          <img src="imgs/project-b/08--animated-fire-02.jpg" />
          <li>選取 fire-animation 後，在右邊的視窗點 “Choose File” 並選擇選取火焰的序列圖檔（按住 Shift 多選）</li>
          <img src="imgs/project-b/08--animated-fire-03.jpg" />
          <li>成功後，會看到系統產生了一個 fire-[1-3] 的序列檔</li>
          <img src="imgs/project-b/08--animated-fire-04.jpg" />
          <li>建立一個材質，並把圖片設為 “fire-animation”，然後就可以看到會動的火焰囉</li>
          <img src="imgs/project-b/08--animated-fire-05.gif" />
          <li>你可以設定 “fire-animation” 的 FPS 數值來改變序列圖的播放速度</li>
          <img src="imgs/project-b/08--animated-fire-06.jpg" />
        </ol>


        <h2 id="setting-up-the-lights">設定光源</h2>

        <p>既然有火在房內燃燒，感覺光應該也要隨著火光閃爍才對。接著我們就要來設定光源的部分</p>


        <h3 id="adding-lights-into-the-scene">在場景內加入燈光</h3>

        <ol>
          <li>刪除系統預設的燈光 directionalLight0 物件（這個物件是在開新專案的時候自動產生的）</li>
          <img src="imgs/project-b/09--add-light-into-scene-01.jpg" />
          <li>選 ambientLight0 並把 Intensity（光源強度）設為 30</li>
          <img src="imgs/project-b/09--add-light-into-scene-02.jpg" />
          <li>加入一個 “Point Light”（點光源）物件，並把他設為 fixedTargetTracker0 的子物件</li>
          <img src="imgs/project-b/09--add-light-into-scene-03-1.jpg" />
          <img src="imgs/project-b/09--add-light-into-scene-03-2.jpg" />
          <li>把點光源物件的位置移到火爐前面</li>
          <img src="imgs/project-b/09--add-light-into-scene-04.jpg" />
          <li>把點光源的 intensity 設為 200（用鍵盤輸入數值的話可以超過 100）然後 range（範圍）設成 0.5</li>
          <img src="imgs/project-b/09--add-light-into-scene-05.jpg" />
        </ol>


        <h3 id="animating-the-light-intensity">設定光源動畫</h3>

        <ol>
          <li>點擊燈光 Intensity 旁邊的小箭頭，把 Intensity 的數值 Patch 加入到 Patch Editor 裡。另外加入一個 Transition Patch、一個 Loop Animation Patch。這就跟上一個雪人專案的動畫部分差不多</li>
          <img src="imgs/project-b/10--animating-light-01.jpg" />
          <li>預設的 Transform Patch 一次會對三個數值做變化（x, y, z），但光的強度 Intensity 只有一個數值。點一下 Transition Patch 底下的 Vector3 小方塊，然後把類型改為 Number</li>
          <img src="imgs/project-b/10--animating-light-02.gif" />
          <li>把這幾個 Patch 接起來，然後可以試試看這種不同的 Curve 和 Intensity 數值，看看怎麼樣比較會有火光閃爍的感覺</li>
          <img src="imgs/project-b/10--animating-light-03.jpg" />
          <li>你也可以另外設定 Ambient Light 的光源動畫。因為這兩個光源應該是同步的，所以你可以使用同一個 Loop Animation Patch 來驅動動畫</li>
          <img src="imgs/project-b/10--animating-light-04.jpg" />
        </ol>


        <h3 id="light-types">*光源的類型</h3>

        <p>如果想要了解不同類型的燈光之間的差異，可以參考官方的教學：<a target="_blank" href="https://sparkar.facebook.com/ar-studio/learn/articles/lights/lights-available">Lights in Spark AR Studio</a></p>


        <h2 id="test-the-room">測試房間效果</h2>

        <p>現在房間已經完成了，可以把濾鏡放到手機裡測試看看。用手機看應該會像這樣：</p>

        <img class="center" src="imgs/project-b/11--test-the-room-01.gif" />

        <p>嗯 ... 感覺好像怪怪的，牆壁感覺好像變成透明的。接下來，我們就要製作遮罩（Mask）來解決這個問題！</p>


        <h2 id="setting-up-the-mask">設定遮罩</h2>

        <p>在 AR 裡面，因為相機通常沒有現實世界中的深度資訊，所以對系統來說，相機拍到的只是一張平平的照片，所以虛擬的 3D 物件總會在畫面的最上層（背景都會被蓋住）。如果想要讓某些現實空間的影像蓋住虛擬影像，就需要使用遮罩</p>

        <p>遮罩不是一個物件，而是一種技巧、概念的稱呼，把某個物件的某部分給遮掉的意思。在 Spark AR 裡面，我們可以透過圖層和材質的設定，來實現遮罩的功能</p>


        <h3 id="set-up-walls-mask">製作牆壁遮罩</h3>

        <ol>
          <li>建立一個 Plane 並命名為 “mask-plane”，然後也建立一個 “mask-mat” 材質</li>
          <img src="imgs/project-b/12--setup-wall-mask-01.jpg" />
          <li>把材質的 Shader Type 設定為 flat，並把 opacity 設成 0</li>
          <img src="imgs/project-b/12--setup-wall-mask-02.jpg" />
          <li>點選 “mask-plane” 並在設定圖層 “layer” 的地方選 “Create New Layer”</li>
          <img src="imgs/project-b/12--setup-wall-mask-03.jpg" />
          <li>系統在此時會建立一個新圖層，並把這個物件設為這個新的圖層</li>
          <img src="imgs/project-b/12--setup-wall-mask-04.jpg" />
          <li>切換到圖層視窗，並把剛剛建立的那個圖層放到最底下</li>
          <img src="imgs/project-b/12--setup-wall-mask-05.jpg" />
          <li>把這個圖層命名為 “mask”</li>
          <img src="imgs/project-b/12--setup-wall-mask-06.jpg" />
          <li>回到場景視窗，應該可以看到 mask-plane 變成透明的了，而且在 mask-plane 背後的部分都會消失不見</li>
          <img src="imgs/project-b/12--setup-wall-mask-07.jpg" />
          <li>複製 mask-plane 並把他們放在 fixedTargetTracker 旁邊，只留下中間窗戶的部分，蓋住房子的其他地方</li>
          <img src="imgs/project-b/12--setup-wall-mask-08.gif" />
        </ol>


        <h3 id="set-up-window-mask">設定窗戶遮罩</h3>

        <ol>
          <li>窗戶的遮罩有一點不一樣，因為窗戶的形狀是透過圖片設定的，而不是整個方形，所以我們需要在材質的地方做一些額外的設定</li>
          <img src="imgs/project-b/13--setup-window-mask-01.jpg" />
          <li>建立一個材質並命名為 “window-mask-mat”</li>
          <img src="imgs/project-b/13--setup-window-mask-02.jpg" />
          <li>建立一個新的 “window-mask-plane” 物件並把材質設為 window-mask-mat</li>
          <img src="imgs/project-b/13--setup-window-mask-03.jpg" />
          <li>移動並縮放 window-mask-plane 讓它剛剛好符合中間辨識圖的大小。要完美符合的話，可以直接把 Scale 設為 3, 3, 1</li>
          <img src="imgs/project-b/13--setup-window-mask-04.jpg" />
          <li>設定材質，把 “Alpha” 部分的圖片設為 “window-alpha”</li>
          <img src="imgs/project-b/13--setup-window-mask-05.jpg" />
          <li>勾選 “Alpha Test”</li>
          <img src="imgs/project-b/13--setup-window-mask-06.jpg" />
          <li>把 Opacity 設成 1，然後 Alpha Test 的 Cutoff 設成 0</li>
          <img src="imgs/project-b/13--setup-window-mask-07.jpg" />
          <li>把 window-mask-plane 的圖層設為 “mask”</li>
          <img src="imgs/project-b/13--setup-window-mask-08.jpg" />
          <li>如果成功的話，應該可以看到窗戶部分的顏色有一些不一樣，窗戶的牆壁部分應該有正確遮住背景</li>
          <li>把濾鏡傳到手機測試看看，如果設定正確的話，應該會像這樣：</li>
          <img src="imgs/project-b/13--setup-window-mask-10.gif" />
        </ol>

        <p>製作到這邊，這個專案就完成囉！<br />
        現在應該能看到像是影片這樣的效果：</p>

        <div class="video-area">
          <iframe width="640" height="480" src="https://www.youtube.com/embed/D3c6aZadGQI" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
        </div>

      </article>
    </div>
    <script type="text/javascript">
    $(window).ready(function(){
        $('body').scrollspy({ target: '#tutorial-project-b' });
    });
    </script>
  </body>
</html>
