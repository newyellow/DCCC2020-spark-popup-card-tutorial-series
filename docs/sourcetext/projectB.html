You can download all the assets here: <a href="https://newyellow.github.io/DCCC2020-spark-popup-card-tutorial-series/download/Project">https://newyellow.github.io/DCCC2020-spark-popup-card-tutorial-series/download/Project</a> B - Woodhouse.zip
<ul>
 	<li>It is strongly recommend you do the Snowman Project tutorial before starting this one. The Snowman Project tutorial has very detailed basic operations which will not be covered in this tutorial.</li>
</ul>
<h2>Setup the tracking</h2>
For this step, you need to do the following:
<ol>
 	<li>Create a new project</li>
 	<li>Add fixedTargetTracker to the scene</li>
 	<li>Import the images for the project</li>
 	<li>Change the fixedTargetTracker image to the window texture</li>
</ol>
After you done, the project will look like this:
<h2>Setting up the room</h2>
<h3>Setup the wall</h3>
For this project, we want to make a "see through window" experience, and make the user feel there's space inside. So we need to build a room space.

In order to make the virtual room's size match the paper model, we can use a reference image to help us create the space.
<ol>
 	<li>Add a Plane on the tracker, and set its material with the building-whole image.</li>
 	<li>Scale and move the reference image, make the window part match with the tracker image.</li>
 	<li>Now create walls behind the reference image. With the reference image, we can make the wall match the building image's size.</li>
 	<li>Add other furnitures into the scene, put them in the positions you like. The depth (position z) difference can create parallax effect.</li>
 	<li>There is also a shadow image for the sofa, and a window-light image to simulate the reflection on the window. Place the shadow image under the sofa. And place the window-light image a little behind the fixedTrackerImage object.</li>
</ol>
<h3>Setup the layers</h3>
<h3>Animated fire</h3>
You can also create animated image with image sequence. Here we have a fire sequence for practice.
<ol>
 	<li>Click Add Asset in the Assets panel.</li>
 	<li>Choose Animation Sequence. And a new asset will be created. Rename it to fire-animation.</li>
 	<li>Click the Choose File in the inspector. And select sequence images.</li>
 	<li>Now a texture sequence object fire-[1-3] is created.</li>
 	<li>Create a material and set the texture to fire-animation. Now you can see the fire is animating.</li>
 	<li>You can change the animation speed by changing the FPS value of fire-animation.</li>
</ol>
Now the room is ready! And you can test it with your device. I would look like this:

Oops, the whole wall is transparent. What we want is a see through window experience. So we now need to setup the mask.
<h2>Setting up the mask</h2>
In augmented reality rendering, the virtual objects are always rendered in front of the camera image. This is because our device camera only captures 2d image from real world, which lacks to depth information. So, in order to make the virtual objects rendered behind the real-world image, we need masks.

In Spark AR Studio, a mask can be created through material with some layer setting.
<h3>Setup walls mask</h3>
<ol>
 	<li>Create a plane named mask-plane, and create a material named mask-mat.</li>
 	<li>Change the shader type to Flat, and set it Opacity to 0</li>
 	<li>Pick mask-plane, click Layer on the right, click Create New Layer</li>
 	<li>Now a new layer is created and assigned to the mask-plane.</li>
 	<li>Now switch to the Layer panel by click the Layer label. Drag the created layer and move it to the bottom. (order it to the last)</li>
 	<li>You could rename the layer name to mask.</li>
 	<li>Now switch back to Scene panel. Now you should see the mask-plane becomes transparent, and also make the images behind it disappear.</li>
 	<li>Duplicate mask-plane and put them beside the fixedTargetTracker. Make sure you leave a whole in the center, which is for the window.</li>
</ol>
<h3>Setup window mask</h3>
<ol>
 	<li>The window mask is a little different. Instead of making the whole rectangle a mask, here we use an image to define the mask shape.</li>
 	<li>Create a new Material and rename it to window-mask-mat</li>
 	<li>Check on Alpha, and set the texture to window-alpha</li>
 	<li>Check on Alpha Test</li>
 	<li>Create a new Plane, and assign the material to the plane. Renamed it to window-mask-plane.</li>
 	<li>Scale the window-mask-plane to fit the fixedTargetTracker reference. The scale should be 3, 3, 1 to be perfectly fit.</li>
 	<li>Set window-mask-plane's layer to mask.</li>
 	<li>Now let setup the material (window-mask-mat) to make it a mask. Set Opacity to 1 and Cutoff (in the Alpha Test section) to 0.</li>
 	<li>You can see the color change, and the window wall is now cover up the background.</li>
 	<li>Test with device. If the result is correct, it should look like this:</li>
</ol>
<h2>Setting up the lights</h2>
The fire is burning inside the house, so the light should also be flickering. Let's setup some light instead of using default lighting.
<ul>
 	<li>while working on this, it might be a trouble if you can't see through the mask. You can disabled the masks by check off the Visible option of the masks.</li>
</ul>
<h3>Add custom light</h3>
<ol>
 	<li>Delete the default directionalLight0 (this object is automatically created while you create the project)</li>
 	<li>Pick the ambientLight0 and set it Intensity value to 30</li>
 	<li>Add a Point Light object. And make sure it is under the fixedTargetTracker0 hierarchy.</li>
 	<li>Place the light in front of fireplace.</li>
 	<li>Set the light's intensity to 200 (you can set above 100 by key-in the value) and Range to 0.5</li>
</ol>
<h3>Animating the light intensity</h3>
<ol>
 	<li>Click the arrow beside the Intensity value. The Patch Editor panel will showed up. Add a Transition patch and a Loop Animation patch. This part is similar to the Project A Animation section.</li>
 	<li>The default Transition patch transforms 3 values (x, y, z). But the intensity value only requires 1. Click the Transition patch, and click the Vector3 box under the patch, and change the value to Number.</li>
 	<li>Connect the inputs and the outputs. Play with the values to make the flickering you like.</li>
 	<li>You can also animate the ambient light. The Loop Animation patch can be used for both Transition patch, if you want to sync the animation.</li>
</ol>
And now the project is done!
